$ch.define("event",function(){"use strict";var a={},b={};$$CHOP.originalSourceFunction=$$CHOP.source;var c=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&++b;return b},d=function(a){var b="change";if("TEXTAREA"===a.tagName.toUpperCase())b="keyup";else if("INPUT"===a.tagName.toUpperCase()){var c=a.getAttribute("type").toUpperCase(),d="TEXT"===c||"PASSWORD"===c;d&&(b="keyup")}return b};$$CHOP.event={},$$CHOP.event={watches:b,listen:function(b,c){if(0===arguments.length)throw new Error("$ch.event.listen requires at least one parameter.");if(1===arguments.length){var d;return d=void 0!==a[b]?a[b]._callback:void 0}return a[b]={},a[b]._event=b,a[b]._callback=c,this},emit:function(b,c){if(0===arguments.length)throw new Error("$ch.event.emit requires at least one parameter.");if($$CHOP._isArray(b)===!1){if(void 0===a[b])return void 0;a[b]._callback(c)}else for(var d=0,e=b.length;d!==e;++d)a[b[d]]._callback(c);return this},watch:function(a,c){if(2!==arguments.length)throw new Error("$ch.event.watch requires two parameters. i.e. data-source name, callback.");var e,f=$$CHOP.sources[a].data;e=$$CHOP._isArray(f)?f.slice(0):"object"==typeof f?Object.create(f):f,b[a]={source:a,old:e,callback:c};var g=function(){if($$CHOP.sources[a].data!==b[a].old){var d={},e=$$CHOP.sources[a].data;d.current=e,d.old=b[a].old,c(d),b[a].old=e}};b[a].watchChange=g;for(var h=0,i=$$CHOP.sources[a].els.length;h!==i;++h){var j=$$CHOP.sources[a].els[h],k=d(j);j.addEventListener(k,g)}return this},unwatch:function(a){if(1!==arguments.length)throw new Error("$ch.event.unwatch has to be given a data-source name parameter.");for(var c=0,e=$$CHOP.sources[a].els.length;c!==e;++c){var f=$$CHOP.sources[a].els[c],g=d(f);f.removeEventListener(g,b[a].watchChange)}return delete b[a],this},once:function(a,b){var c,d;return function(){return d?c:(c=a.apply(b||this,arguments),d=1,a=null,c)}},nextTick:function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),queue:function(){var a={callbacks:[],current:0,length:0,data:void 0,add:function(a){if(void 0!==a)if($$CHOP.isArray(a)){var b=this;$$CHOP.each(a,function(a){b.callbacks.push(a),++b.length})}else this.callbacks.push(a),++this.length;return this},remove:function(a){if(void 0!==a){var b;if($$CHOP.isArray(a)){var c=this;$$CHOP.each(a,function(a){b=c.callbacks.indexOf(a),-1!==b&&(c.callbacks.splice(b,1),--c.length)})}else b=this.callbacks.indexOf(a),-1!==b&&(this.callbacks.splice(b,1),--this.length)}return this},promote:function(a){if(void 0!==a){var b=this.callbacks.indexOf(a);if(-1!==b){var c=this.callbacks.splice(b,1)[0];this.callbacks.unshift(c)}}return this},reset:function(){return this.current=0,this},run:function(a){if(0!==arguments.length&&(this.data=a),this.current<this.length){var b=this.current;++this.current,this.data=this.callbacks[b](this.data)}return this.data},stop:function(){this.current=0;var a=this.data;return this.data=void 0,a}};return $$CHOP.each(arguments,function(b,c){a.add(c)}),a}};var e=function(a){var d=b[a];if(void 0===d)return void 0;var e=$$CHOP.sources[d.source].data,f=!1;if(typeof e!=typeof d.old)f=!0;else if($$CHOP._isArray(e)){if(e.length!==d.old.length)f=!0;else for(var g=0,h=e.length;g!==h;++g)if(e[g]!==d.old[g]){f=!0;break}}else"object"==typeof e&&f===!1?c(e)!==c(d.old)?f=!0:$$CHOP.each(e,function(a){e[a]!==d.old[a]&&(f=!0)}):e!==d.old&&f===!1&&(f=!0);f===!0&&(d.current=e,d.old=e,d.callback(d))},f=function(a,b){return 0===arguments.length?$$CHOP.originalSourceFunction():1===arguments.length?$$CHOP.originalSourceFunction(a):($$CHOP.originalSourceFunction(a,b),void e(a))};$$CHOP.source=f});