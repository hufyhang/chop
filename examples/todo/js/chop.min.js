!function(e,t){"use strict";var r=e,n=function(e){return"[object Array]"===Object.prototype.toString.call(e)};Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}());var i={el:t,html:"",render:function(){var e;return e="function"==typeof this.html?this.html():this.html,this.el===t?e:(this.el.html(e),void c._loadView(this.el.el))}},s={el:t,_views:[],focus:function(){return this.el.focus(),this},val:function(e){return e!==t?(this.el.value=e,this):this.el.value},html:function(e){return e?(this.el.innerHTML=e,this):this.el.innerHTML},append:function(e){return e&&(this.el.innerHTML=this.el.innerHTML+e),this},attr:function(e,t){return 0===arguments.length?this.el.attributes:(2===arguments.length&&this.el.setAttribute(e,t),this)},click:function(e){return e?(this.el.addEventListener("click",e),this):void this.el.click()},keypress:function(e){return e?(this.el.addEventListener("keypress",e),this):!1},change:function(e){return e?(this.el.addEventListener("change",e),this):!1},_cssReplacer:function(e,t){return t=t.replace(/-/g,""),t.toUpperCase()},css:function(e,t){return 0!==arguments.length?(e=e.replace(/(-[a-z])/g,this._cssReplacer),this.el.style[e]=t,this):this.el.style.cssText},view:function(e){if(e){var t=this.el;t.innerHTML="";var r=!1;if(n(e)){r=!0;for(var i=0;i!==e.length;++i){var s=e[i];this._addView(t,s,r)}}else this._addView(t,e);c._loadView(t)}},_addView:function(e,t,r){var n=t.render();n&&(r?e.innerHTML+=n:e.innerHTML=n),this._views.push(t)}},a={routes:{},mode:"hash",root:"/",getFragment:function(){var t=e.location.href.match(/#(.*)$/),r=t?t[1]:"";return this.clearSlashes(r)},clearSlashes:function(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(e){if(!e)return!1;var t,r;for(var n in e)e.hasOwnProperty(n)&&(t=n,r=e[n],this.routes[t]=r);return!0},remove:function(e){return e&&(n(e)||(e=[e]),e.forEach(function(e){delete this.routes[e]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(r){r=r?r:"";var n=r.match(/^\/.*/);n||(r="/"+r),e.location.href.match(/#(.*)$/),e.location.href=e.location.href.replace(/#(.*)$/,"")+"#"+r;for(var i=this.getFragment(r),s={},a=Object.keys(this.routes),c=0,u=a.length;c!==u;++c){var o=a[c];o=o.replace(/:\w+/g,".+");var l=new RegExp(o),h=i.match(l);if(null!==h){var d=a[c],f=[],v=d.match(/:\w+/g);if(null!==v){var p,g,m=d.split("/");for(p=0,g=v.length;p!==g;++p){var y=v[p],w=m.indexOf(y),_=y.replace(/:/,"");-1!==w&&s[_]===t&&(f.push(w),s[_]="")}m=i.split("/");var E=Object.keys(s);for(p=0,g=f.length;p!==g;++p){var M=f[p];s[E[p]]=m[M]}}}}a=Object.keys(this.routes);for(var b=0;b!==a.length;++b){var T=a[b],L=a[b];if(T!==t){T=T.replace(/\//g,"\\/"),T=T.replace(/:\w+/g,".+");var k=new RegExp(T);null!==i.match(k)&&this.routes[L](s)}}return this}},c={_path:"",els:[],modules:{},sources:{},router:a,find:function(e){if(e){var r=document.querySelector(e);if(!r)return t;var n=Object.create(s);return n.el=r,n}return!1},findAll:function(e){if(e){for(var t=document.querySelectorAll(e),r=[],n=0;n!==t.length;++n){var i=Object.create(s);i.el=t[n],r[n]=i}return r}return!1},view:function(e){if(!e)return!1;var t=Object.create(i);return e.html&&(t.html=e.html),t},template:function(e,r){if(!e&&!r)return!1;if(!r)return e;var n=e.match(/{{.+?}}/g);return n&&n.forEach(function(n){var i=n.replace(/{/g,"");i=i.replace(/}/g,""),r[i]!==t&&(e=e.replace(n,r[i]))}),e=e.replace(/\\{/g,"{"),e=e.replace(/\\}/g,"}")},_addEvent:function(e,t,r){for(var n=e.querySelectorAll("["+t+"]"),i=0;i!==n.length;++i){var s=n[i].getAttribute(t);s=s.replace(/\$ch\.event/g,"arguments[0]");var a=s.match(/{{.+?}}/g);if(a)for(var c=0;c!==a.length;++c){var u=a[c],o=u.replace(/{/g,"");o=o.replace(/}/g,""),s=s.replace(u,"$ch.sources."+o+".data")}s=s.replace(/\\{/g,"{"),s=s.replace(/\\}/g,"}");var l=new Function(s);n[i].addEventListener(r,l)}},_registerEvents:function(e){e===t&&(e=document),this._addEvent(e,"ch-click","click"),this._addEvent(e,"ch-keypress","keypress"),this._addEvent(e,"ch-keydown","keydown"),this._addEvent(e,"ch-keyup","keyup"),this._addEvent(e,"ch-change","change")},_loadMain:function(){var e=document.querySelector("script[ch-main]");if(!e)return!1;var t=e.getAttribute("ch-main");if(this._path=t.substring(0,t.lastIndexOf("/")+1),t){var r=document.createElement("script");r.src=t,document.querySelector("head").appendChild(r),r.onload=function(){c._loadView()}}},_loadView:function(r){var n;r===t&&(r=document);for(var i=r.querySelectorAll("[ch-view]"),s=0;s!==i.length;++s){n=i[s].getAttribute("ch-view"),n=n.replace(/\ /g,""),i[s].innerHTML="";for(var a,u=n.split(","),o=0;o!==u.length;++o){a=u[o];var l=e[a].render();l&&(i[s].innerHTML+=l)}}c._registerEvents(r),c._bindSources(r)},http:function(r){if(!r.url)return!1;var n=r.url,i=r.method||"GET";i=i.toUpperCase();var s=r.data||{},a="";for(var c in s)s.hasOwnProperty(c)&&(a+=c+"="+s[c]+"&");s=a.slice(0,-1);var u=r.done||function(){return!1};r.async===t&&(r.async=!0);var o,l=r.async;o=e.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.open(i,n,l),o.onreadystatechange=function(){4===o.readyState&&l&&u({data:o.responseText,status:o.status})};var h=i&&"GET"!==i.toUpperCase()&&0!==s.length;return h?(o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(s)):o.send(),l?void 0:o.responseText},define:function(e,t){this.modules[e]=t()},_useModule:function(e,t){var r,n=e,i=n.shift(),s=this,a=document.querySelector('script[ch-module="'+i+'"]');if(a)this._executeModule(n,t);else{var c=this.http({url:this._path+i+".js",method:"get",async:!1});r=document.createElement("script"),r.setAttribute("ch-module",i),r.text=c,document.querySelector("head").appendChild(r),s._executeModule(n,t)}},_executeModule:function(e,t){e.length?this._useModule(e,t):t&&t()},require:function(e,t){return e?(n(e)||(e=[e]),void this._useModule(e,t)):!1},module:function(e){return e!==t?this.modules[e]:this.modules},source:function(e,r){if(0===arguments.length)return this.sources;if(1===arguments.length){var n=this.sources[e];return n===t?t:n.data}var i=2===arguments.length&&this.sources[e]!==t;if(!i)return 2===arguments.length?(this.sources[e]={},this.sources[e].els=[],this.sources[e].data=r,this.sources[e]):!1;var s=this.sources[e];s.data=r;for(var a=0,c=s.els.length;a!==c;++a){var u=s.els[a];"INPUT"===u.tagName.toUpperCase()?u.value=r:u.innerHTML=r}},_bindSources:function(e){e===t&&(e=document);for(var r=e.querySelectorAll("[ch-source]"),n=0;n!==r.length;++n){var i=r[n],s=i.getAttribute("ch-source"),a=this.sources[s],c="";a===t&&(this.sources[s]={},a=this.sources[s],a.els=[],i.value!==t&&(c=i.value)),a.els.push(i),a.data=c,i.addEventListener("keyup",function(){a.data=this.value,a.els.forEach(function(e){var t;t="INPUT"===e.tagName.toUpperCase()?"value":"innerHTML",e[t]!==a.data&&(e[t]=a.data)})})}}};r.$ch=c,r.onload=function(){c._loadMain()}}(window);