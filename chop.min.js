!function(window,undefined){"use strict";var root=window,_isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}());var chopView={el:undefined,html:"",render:function(){var e;return e="function"==typeof this.html?this.html():this.html,this.el===undefined?e:(this.el.html(e),void chop._loadView(this.el.el))}},chopModel={_data:{},set:function(e,t){return 0===arguments.length?!1:(t===undefined?this._data=e:this._data[e]=t,this)},get:function(e,t){var n,r=this._data,i=this._data;return t===undefined?n=e:(r=e,n=t),n!==undefined&&(i=r[n]),i},each:function(e,t){var n,r=this._data;if(0===arguments.length)return!1;if(t===undefined?n=e:(r=this._data[e],n=t),r===undefined||null===r)return!1;for(var i=0;i!==r.length;++i)e=r[i],n(e,i,r)},_checkMatch:function(data,expr){var $$=data;return eval(expr)},filter:function(e,t){var n,r=this._data,i=[];if(0===arguments.length)return undefined;if(t===undefined?n=e:(r=this._data[e],n=t),r===undefined||null===r)return i;for(var a=0;a!==r.length;++a){var u=r[a];this._checkMatch(u,n)&&i.push(u)}return i}},chopEl={el:undefined,_views:[],focus:function(){return this.el.focus(),this},val:function(e){return e!==undefined?(this.el.value=e,this):this.el.value},html:function(e){return e?(this.el.innerHTML=e,this):this.el.innerHTML},append:function(e){return e&&(this.el.innerHTML=this.el.innerHTML+e),this},attr:function(e,t){return 0===arguments.length?this.el.attributes:(2===arguments.length&&this.el.setAttribute(e,t),this)},click:function(e){return e?(this.el.addEventListener("click",e),this):void this.el.click()},keypress:function(e){return e?(this.el.addEventListener("keypress",e),this):!1},change:function(e){return e?(this.el.addEventListener("change",e),this):!1},_cssReplacer:function(e,t){return t=t.replace(/-/g,""),t.toUpperCase()},css:function(e,t){return 0!==arguments.length?(e=e.replace(/(-[a-z])/g,this._cssReplacer),this.el.style[e]=t,this):this.el.style.cssText},view:function(e){if(e){var t=this.el;t.innerHTML="";var n=!1;if(_isArray(e)){n=!0;for(var r=0;r!==e.length;++r){var i=e[r];this._addView(t,i,n)}}else this._addView(t,e);chop._loadView(t)}},_addView:function(e,t,n){var r=t.render();r&&(n?e.innerHTML+=r:e.innerHTML=r),this._views.push(t)}},Router={routes:{},mode:"hash",root:"/",getFragment:function(){var e=window.location.href.match(/#(.*)$/),t=e?e[1]:"";return this.clearSlashes(t)},clearSlashes:function(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(e){if(!e)return!1;var t,n;for(var r in e)e.hasOwnProperty(r)&&(t=r,n=e[r],this.routes[t]=n);return!0},remove:function(e){return e&&(_isArray(e)||(e=[e]),e.forEach(function(e){delete this.routes[e]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(e){e=e?e:"";var t=e.match(/^\/.*/);t||(e="/"+e),window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e;for(var n=this.getFragment(e),r={},i=Object.keys(this.routes),a=0,u=i.length;a!==u;++a){var s=i[a];s=s.replace(/:\w+/g,".+");var c=new RegExp(s),o=n.match(c);if(null!==o){var h=i[a],l=[],d=h.match(/:\w+/g);if(null!==d){var f,v,p=h.split("/");for(f=0,v=d.length;f!==v;++f){var g=d[f],m=p.indexOf(g),w=g.replace(/:/,"");-1!==m&&r[w]===undefined&&(l.push(m),r[w]="")}p=n.split("/");var _=Object.keys(r);for(f=0,v=l.length;f!==v;++f){var y=l[f];r[_[f]]=p[y]}}}}i=Object.keys(this.routes);for(var M=0;M!==i.length;++M){var E=i[M],b=i[M];if(E!==undefined){E=E.replace(/\//g,"\\/"),E=E.replace(/:\w+/g,".+");var T=new RegExp(E);null!==n.match(T)&&this.routes[b](r)}}return this}},chop={_path:"",els:[],modules:{},sources:{},router:Router,find:function(e){if(e){var t=document.querySelector(e);if(!t)return undefined;var n=Object.create(chopEl);return n.el=t,n}return!1},findAll:function(e){if(e){for(var t=document.querySelectorAll(e),n=[],r=0;r!==t.length;++r){var i=Object.create(chopEl);i.el=t[r],n[r]=i}return n}return!1},model:function(e){if(0===arguments.length)return undefined;var t=Object.create(chopModel);return t._data=e,t},view:function(e){if(0===arguments.length)return!1;var t=Object.create(chopView);return e.html&&(t.html=e.html),t},template:function(e,t){if(!e&&!t)return!1;if(!t)return e;var n=e.match(/{{.+?}}/g);return n&&n.forEach(function(n){var r=n.replace(/{/g,"");r=r.replace(/}/g,""),t[r]!==undefined&&(e=e.replace(n,t[r]))}),e=e.replace(/\\{/g,"{"),e=e.replace(/\\}/g,"}")},_addEvent:function(e,t,n){for(var r=e.querySelectorAll("["+t+"]"),i=0;i!==r.length;++i){var a=r[i].getAttribute(t);a=a.replace(/\$\$\.event/g,"arguments[0]");var u=a.match(/{{.+?}}/g);if(u)for(var s=0;s!==u.length;++s){var c=u[s],o=c.replace(/{/g,"");o=o.replace(/}/g,""),a=a.replace(c,"$ch.sources."+o+".data")}a=a.replace(/\\{/g,"{"),a=a.replace(/\\}/g,"}");var h=new Function(a);r[i].addEventListener(n,h)}},_registerEvents:function(e){e===undefined&&(e=document),this._addEvent(e,"ch-click","click"),this._addEvent(e,"ch-keypress","keypress"),this._addEvent(e,"ch-keydown","keydown"),this._addEvent(e,"ch-keyup","keyup"),this._addEvent(e,"ch-change","change")},_loadMain:function(){var e=document.querySelector("script[ch-main]");if(!e)return!1;var t=e.getAttribute("ch-main");if(this._path=t.substring(0,t.lastIndexOf("/")+1),t){var n=document.createElement("script");n.src=t,document.querySelector("head").appendChild(n),n.onload=function(){chop._loadView()}}},_loadView:function(e){var t;e===undefined&&(e=document);for(var n=e.querySelectorAll("[ch-view]"),r=0;r!==n.length;++r){t=n[r].getAttribute("ch-view"),t=t.replace(/\ /g,""),n[r].innerHTML="";for(var i,a=t.split(","),u=0;u!==a.length;++u){i=a[u];var s=window[i].render();s&&(n[r].innerHTML+=s)}}chop._registerEvents(e),chop._bindSources(e)},http:function(e){if(!e.url)return!1;var t=e.url,n=e.method||"GET";n=n.toUpperCase();var r=e.data||{},i="";for(var a in r)r.hasOwnProperty(a)&&(i+=a+"="+r[a]+"&");r=i.slice(0,-1);var u=e.done||function(){return!1};e.async===undefined&&(e.async=!0);var s,c=e.async;s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s.open(n,t,c),s.onreadystatechange=function(){4===s.readyState&&c&&u({data:s.responseText,status:s.status})};var o=n&&"GET"!==n.toUpperCase()&&0!==r.length;return o?(s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(r)):s.send(),c?void 0:s.responseText},define:function(e,t){this.modules[e]=t()},_useModule:function(e,t){var n,r=e,i=r.shift(),a=this,u=document.querySelector('script[ch-module="'+i+'"]');if(u)this._executeModule(r,t);else{var s=this.http({url:this._path+i+".js",method:"get",async:!1});n=document.createElement("script"),n.setAttribute("ch-module",i),n.text=s,document.querySelector("head").appendChild(n),a._executeModule(r,t)}},_executeModule:function(e,t){e.length?this._useModule(e,t):t&&t()},require:function(e,t){return e?(_isArray(e)||(e=[e]),void this._useModule(e,t)):!1},module:function(e){return e!==undefined?this.modules[e]:this.modules},source:function(e,t){if(0===arguments.length)return this.sources;if(1===arguments.length){var n=this.sources[e];return n===undefined?undefined:n.data}var r=2===arguments.length&&this.sources[e]!==undefined;if(!r)return 2===arguments.length?(this.sources[e]={},this.sources[e].els=[],this.sources[e].data=t,this.sources[e]):!1;var i=this.sources[e];i.data=t;for(var a=0,u=i.els.length;a!==u;++a){var s=i.els[a];"INPUT"===s.tagName.toUpperCase()?s.value=t:s.innerHTML=t}},_bindSources:function(e){e===undefined&&(e=document);for(var t=e.querySelectorAll("[ch-source]"),n=0;n!==t.length;++n){var r=t[n],i=r.getAttribute("ch-source"),a=this.sources[i],u="";a===undefined&&(this.sources[i]={},a=this.sources[i],a.els=[],r.value!==undefined&&(u=r.value)),a.els.push(r),a.data=u,r.addEventListener("keyup",function(){a.data=this.value,a.els.forEach(function(e){var t;t="INPUT"===e.tagName.toUpperCase()?"value":"innerHTML",e[t]!==a.data&&(e[t]=a.data)})})}}};root.$ch=chop,root.onload=function(){chop._loadMain()}}(window);