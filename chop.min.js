!function(e,t){"use strict";var r=e,n=function(e){return"[object Array]"===Object.prototype.toString.call(e)};Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}(),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}));var a={el:t,html:"",render:function(){var e;return e="function"==typeof this.html?this.html():this.html,this.el===t?e:(this.el.innerHTML=e,void o._loadView(this.el))}},s={el:t,_views:[],focus:function(){return this.el.focus(),this},val:function(e){return e!==t?(this.el.value=e,this):this.el.value},html:function(e){return e?(this.el.innerHTML=e,this):this.el.innerHTML},append:function(e){return e!==t&&(this.el.innerHTML=this.el.innerHTML+e),this},attr:function(e,t){return 0===arguments.length?this.el.attributes:(2===arguments.length&&this.el.setAttribute(e,t),this)},on:function(e,t){if(2!==arguments.length)throw new Error("$ch.on requires an event and a callback parameter.");this.el.addEventListener(e,t)},click:function(e){return e!==t?(this.el.addEventListener("click",e),this):void this.el.click()},keypress:function(e){if(e===t)throw new Error("$ch.keypress requires a parameter.");return this.el.addEventListener("keypress",e),this},change:function(e){if(e===t)throw new Error("$ch.keypress requires a parameter.");return this.el.addEventListener("change",e),this},_cssReplacer:function(e,t){return t=t.replace(/-/g,""),t.toUpperCase()},css:function(e,t){return 0!==arguments.length?(e=e.replace(/(-[a-z])/g,this._cssReplacer),this.el.style[e]=t,this):this.el.style.cssText},view:function(e){if(e){var t=this.el;t.innerHTML="";var r=!1;if(n(e)){r=!0;for(var a=0;a!==e.length;++a){var s=e[a];this._addView(t,s,r)}}else this._addView(t,e);o._loadView(t)}},_addView:function(e,r,n){var a;a="function"==typeof r.html?r.html():r.html,a!==t&&(n===!0?e.innerHTML+=a:e.innerHTML=a),this._views.push(r)}},i={routes:{},mode:"hash",root:"/",getFragment:function(){var t=e.location.href.match(/#(.*)$/),r=t?t[1]:"";return this.clearSlashes(r)},clearSlashes:function(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(e){if(e===t)throw new Error("$ch.router.add requires a parameter.");var r,n;for(var a in e)e.hasOwnProperty(a)&&(r=a,n=e[a],this.routes[r]=n);return!0},remove:function(e){return e&&(n(e)||(e=[e]),e.forEach(function(e){delete this.routes[e]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(r){if(0===arguments.length)throw new Error("$ch.navigate requires a parameter.");r=r?r:"";var n=r.match(/^\/.*/);n||(r="/"+r),e.location.href.match(/#(.*)$/),e.location.href=e.location.href.replace(/#(.*)$/,"")+"#"+r;for(var a=this.getFragment(r),s={},i=Object.keys(this.routes),o=0,u=i.length;o!==u;++o){var c=i[o];c=c.replace(/:\w+/g,".+");var l=new RegExp(c),h=a.match(l);if(null!==h){var f=i[o],d=[],v=f.match(/:\w+/g);if(null!==v){var p,m,g=f.split("/");for(p=0,m=v.length;p!==m;++p){var w=v[p],y=g.indexOf(w),E=w.replace(/:/,"");-1!==y&&s[E]===t&&(d.push(y),s[E]="")}g=a.split("/");var _=Object.keys(s);for(p=0,m=d.length;p!==m;++p){var b=d[p];s[_[p]]=g[b]}}}}i=Object.keys(this.routes);for(var T=0;T!==i.length;++T){var $=i[T],M=i[T];if($!==t){$=$.replace(/\//g,"\\/"),$=$.replace(/:\w+/g,".+");var O=new RegExp($);null!==a.match(O)&&this.routes[M](s)}}return this}},o={_path:"",els:[],modules:{},sources:{},router:i,find:function(e){if(e!==t){var r=document.querySelector(e);if(!r)return t;var n=Object.create(s);return n.el=r,n}throw new Error("$ch.find requires a parameter.")},findAll:function(e){if(e!==t){for(var r=document.querySelectorAll(e),n=[],a=0;a!==r.length;++a){var i=Object.create(s);i.el=r[a],n[a]=i}return n}throw new Error("$ch.findAll requires a parameter.")},view:function(e){if(0===arguments.length)throw new Error("$ch.view requires a parameter.");var t=Object.create(a);return e.html&&(t.html=e.html),t},template:function(e,r){if(!e&&!r)throw new Error("invalid parameters for $ch.template.");if(!r)return e;var n=e.match(/{{.+?}}/g);return n&&n.forEach(function(n){var a=n.replace(/{/g,"");a=a.replace(/}/g,""),r[a]!==t&&(e=e.replace(n,r[a]))}),e=e.replace(/\\{/g,"{"),e=e.replace(/\\}/g,"}")},_addEvent:function(e,t,r){for(var n=e.querySelectorAll("["+t+"]"),a=0;a!==n.length;++a){var s=n[a].getAttribute(t);s=s.replace(/\$ch\.event/g,"arguments[0]");var i=s.match(/{{.+?}}/g);if(i)for(var o=0;o!==i.length;++o){var u=i[o],c=u.replace(/{/g,"");c=c.replace(/}/g,"");var l=c.split("|");if(1===l.length)s=s.replace(u,"$ch.sources."+c+".data");else{c=l[0].trim();for(var h=1;h!==l.length;++h){var f=l[h].trim(),d=null!==f.match(/filter\:.+/g);d&&(f=f.replace(/filter\:\ */g,""),s=s.replace(u,"$ch.filter($ch.sources."+c+".data, "+f+")"))}}}s=s.replace(/\\{/g,"{"),s=s.replace(/\\}/g,"}");var v=new Function(s);n[a].addEventListener(r,v)}},_registerEvents:function(e){e===t&&(e=document),this._addEvent(e,"ch-click","click"),this._addEvent(e,"ch-dbclick","dbclick"),this._addEvent(e,"ch-keypress","keypress"),this._addEvent(e,"ch-keydown","keydown"),this._addEvent(e,"ch-keyup","keyup"),this._addEvent(e,"ch-change","change"),this._addEvent(e,"ch-mousedown","mousedown"),this._addEvent(e,"ch-mouseup","mouseup"),this._addEvent(e,"ch-mouseenter","mouseenter"),this._addEvent(e,"ch-mousemove","mousemove"),this._addEvent(e,"ch-mouseout","mouseout"),this._addEvent(e,"ch-mouseover","mouseover"),this._addEvent(e,"ch-mouseleave","mouseleave")},_loadMain:function(){var e=document.querySelector("script[ch-main]");e||o._loadView();var t=e.getAttribute("ch-main");if(this._path=t.substring(0,t.lastIndexOf("/")+1),t){var r=document.createElement("script");r.src=t,document.querySelector("head").appendChild(r),r.onload=function(){o._loadView()}}},_loadView:function(r){var n;r===t&&(r=document);for(var a=r.querySelectorAll("[ch-view]"),s=0;s!==a.length;++s){n=a[s].getAttribute("ch-view"),n=n.replace(/\ /g,""),a[s].innerHTML="";for(var i,u=n.split(","),c=0;c!==u.length;++c){i=u[c],e[i].el=t;var l=e[i].render();e[i].el=a[s],l&&(a[s].innerHTML+=l)}}o._registerEvents(r),o._bindSources(r)},http:function(r){if(!r.url)throw new Error("URL parameter not found for $ch.http.");var n=r.url,a=r.method||"GET";a=a.toUpperCase();var s=r.data||{},i="";for(var o in s)s.hasOwnProperty(o)&&(i+=o+"="+s[o]+"&");s=i.slice(0,-1);var u=r.done||function(){return!1};r.async===t&&(r.async=!0);var c,l=r.async;c=e.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c.open(a,n,l),c.onreadystatechange=function(){4===c.readyState&&l&&u({data:c.responseText,status:c.status})};var h=a&&"GET"!==a.toUpperCase()&&0!==s.length;return h?(c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(s)):c.send(),l?void 0:c.responseText},define:function(e,t){this.modules[e]=t()},_useModule:function(e,t){var r,n=e,a=n.shift(),s=this,i=document.querySelector('script[ch-module="'+a+'"]');if(i)this._executeModule(n,t);else{var o=this.http({url:this._path+a+".js",method:"get",async:!1});r=document.createElement("script"),r.setAttribute("ch-module",a),r.text=o,document.querySelector("head").appendChild(r),s._executeModule(n,t)}},_executeModule:function(e,t){e.length?this._useModule(e,t):t&&t()},require:function(e,t){return e?(n(e)||(e=[e]),void this._useModule(e,t)):!1},module:function(e){return e!==t?this.modules[e]:this.modules},source:function(e,r){if(0===arguments.length)return this.sources;if(1===arguments.length){var n=this.sources[e];return n===t?t:n.data}var a=2===arguments.length&&this.sources[e]!==t;if(!a)return 2===arguments.length?(this.sources[e]={},this.sources[e].els=[],this.sources[e].data=r,this.sources[e]):!1;var s=this.sources[e];s.data=r;for(var i=0,o=s.els.length;i!==o;++i){var u=s.els[i],c=u.tagName.toUpperCase();"INPUT"===c||"TEXTAREA"===c?u.value=r:u.innerHTML=r}},_bindSources:function(e){e===t&&(e=document);for(var r=e.querySelectorAll("[ch-source]"),n=0;n!==r.length;++n){var a=r[n],s=a.getAttribute("ch-source"),i=this.sources[s],o="";i===t&&(this.sources[s]={},i=this.sources[s],i.els=[],a.value!==t&&(o=a.value)),i.els.push(a),i.data=o,a.addEventListener("keyup",function(){i.data=this.value,i.els.forEach(function(e){var t;t="INPUT"===e.tagName.toUpperCase()?"value":"innerHTML",e[t]!==i.data&&(e[t]=i.data)})})}},each:function(e,t){var r,a,s;if(2!==arguments.length)throw new Error("$ch.each requires two parameters (i.e. obj, callback).");if(r=t,n(e))for(s=0;s!==e.length;++s)a=e[s],r(a,s,e);else{var i=Object.keys(e);for(s=0;s!==i.length;++s){var o=i[s],u=e[o];r(o,u,s,e)}}},filter:function(e,r){var n=[];if(2!==arguments.length)throw new Error("$ch.filter requires two parameters (i.e. obj, expr).");if(e===t||null===e)return n;for(var a=0;a!==e.length;++a){var s=e[a];r(s)===!0&&n.push(s)}return n},store:function(e,r){if("undefined"==typeof Storage)throw new Error("Local storage is not supported by browser.");if(0===arguments.length)throw new Error("$ch.store requires at least one parameter.");if(1===arguments.length){var n=localStorage.getItem(e);return null!==n&&(n=JSON.parse(n)),n}if(r===t)throw new Error("$ch.store does not allow undefined value.");localStorage.setItem(e,JSON.stringify(r))},_xmlToJson:function(e){var t={};if(1===e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);t["@attributes"][n.nodeName]=n.nodeValue}}}else 3===e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var a=0;a<e.childNodes.length;a++){var s=e.childNodes.item(a),i=s.nodeName;if("undefined"==typeof t[i])t[i]=this._xmlToJson(s);else{if("undefined"==typeof t[i].push){var o=t[i];t[i]=[],t[i].push(o)}t[i].push(this._xmlToJson(s))}}return t},xmlToJson:function(t){var r;if(0===arguments.length)throw new Error("$ch.xmlToJson requires a parameter.");if("string"==typeof t)if(e.ActiveXObject)r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(t);else{var n=new DOMParser;r=n.parseFromString(t,"text/xml")}else r=t;return this._xmlToJson(r)},urlParams:function(t){for(var r={},n=e.location.search.substring(1),a=n.split("&"),s=0;s<a.length;s++){var i=a[s].split("=");if(0===arguments.length)r[i[0]]=i[1];else if(i[0]===t)return i[1]}return r}};r.$ch=o,r.$$CHOP=o,r.$$CHOPEL=s,r.$$CHOPVIEW=a,r.onload=function(){o._loadMain()}}(window);