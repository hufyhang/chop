!function(window,undefined){"use strict";var root=window,_isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};Object.create||(Object.create=function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}(),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}));var chopView={el:undefined,html:"",render:function(){var e;return e="function"==typeof this.html?this.html():this.html,this.el===undefined?e:(this.el.html(e),void chop._loadView(this.el.el))}},chopEl={el:undefined,_views:[],focus:function(){return this.el.focus(),this},val:function(e){return e!==undefined?(this.el.value=e,this):this.el.value},html:function(e){return e?(this.el.innerHTML=e,this):this.el.innerHTML},append:function(e){return e&&(this.el.innerHTML=this.el.innerHTML+e),this},attr:function(e,t){return 0===arguments.length?this.el.attributes:(2===arguments.length&&this.el.setAttribute(e,t),this)},click:function(e){return e?(this.el.addEventListener("click",e),this):void this.el.click()},keypress:function(e){return e?(this.el.addEventListener("keypress",e),this):!1},change:function(e){return e?(this.el.addEventListener("change",e),this):!1},_cssReplacer:function(e,t){return t=t.replace(/-/g,""),t.toUpperCase()},css:function(e,t){return 0!==arguments.length?(e=e.replace(/(-[a-z])/g,this._cssReplacer),this.el.style[e]=t,this):this.el.style.cssText},view:function(e){if(e){var t=this.el;t.innerHTML="";var r=!1;if(_isArray(e)){r=!0;for(var n=0;n!==e.length;++n){var i=e[n];this._addView(t,i,r)}}else this._addView(t,e);chop._loadView(t)}},_addView:function(e,t,r){var n=t.render();n&&(r?e.innerHTML+=n:e.innerHTML=n),this._views.push(t)}},Router={routes:{},mode:"hash",root:"/",getFragment:function(){var e=window.location.href.match(/#(.*)$/),t=e?e[1]:"";return this.clearSlashes(t)},clearSlashes:function(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(e){if(!e)return!1;var t,r;for(var n in e)e.hasOwnProperty(n)&&(t=n,r=e[n],this.routes[t]=r);return!0},remove:function(e){return e&&(_isArray(e)||(e=[e]),e.forEach(function(e){delete this.routes[e]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(e){e=e?e:"";var t=e.match(/^\/.*/);t||(e="/"+e),window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e;for(var r=this.getFragment(e),n={},i=Object.keys(this.routes),a=0,s=i.length;a!==s;++a){var u=i[a];u=u.replace(/:\w+/g,".+");var o=new RegExp(u),c=r.match(o);if(null!==c){var h=i[a],l=[],d=h.match(/:\w+/g);if(null!==d){var f,v,p=h.split("/");for(f=0,v=d.length;f!==v;++f){var g=d[f],m=p.indexOf(g),w=g.replace(/:/,"");-1!==m&&n[w]===undefined&&(l.push(m),n[w]="")}p=r.split("/");var y=Object.keys(n);for(f=0,v=l.length;f!==v;++f){var _=l[f];n[y[f]]=p[_]}}}}i=Object.keys(this.routes);for(var b=0;b!==i.length;++b){var E=i[b],M=i[b];if(E!==undefined){E=E.replace(/\//g,"\\/"),E=E.replace(/:\w+/g,".+");var k=new RegExp(E);null!==r.match(k)&&this.routes[M](n)}}return this}},chop={_path:"",els:[],modules:{},sources:{},router:Router,find:function(e){if(e){var t=document.querySelector(e);if(!t)return undefined;var r=Object.create(chopEl);return r.el=t,r}return!1},findAll:function(e){if(e){for(var t=document.querySelectorAll(e),r=[],n=0;n!==t.length;++n){var i=Object.create(chopEl);i.el=t[n],r[n]=i}return r}return!1},model:function(e){if(0===arguments.length)return undefined;var t=Object.create(chopModel);return t._data=e,t},view:function(e){if(0===arguments.length)return!1;var t=Object.create(chopView);return e.html&&(t.html=e.html),t},template:function(e,t){if(!e&&!t)return!1;if(!t)return e;var r=e.match(/{{.+?}}/g);return r&&r.forEach(function(r){var n=r.replace(/{/g,"");n=n.replace(/}/g,""),t[n]!==undefined&&(e=e.replace(r,t[n]))}),e=e.replace(/\\{/g,"{"),e=e.replace(/\\}/g,"}")},_addEvent:function(e,t,r){for(var n=e.querySelectorAll("["+t+"]"),i=0;i!==n.length;++i){var a=n[i].getAttribute(t);a=a.replace(/\$\$\.event/g,"arguments[0]");var s=a.match(/{{.+?}}/g);if(s)for(var u=0;u!==s.length;++u){var o=s[u],c=o.replace(/{/g,"");c=c.replace(/}/g,""),a=a.replace(o,"$ch.sources."+c+".data")}a=a.replace(/\\{/g,"{"),a=a.replace(/\\}/g,"}");var h=new Function(a);n[i].addEventListener(r,h)}},_registerEvents:function(e){e===undefined&&(e=document),this._addEvent(e,"ch-click","click"),this._addEvent(e,"ch-keypress","keypress"),this._addEvent(e,"ch-keydown","keydown"),this._addEvent(e,"ch-keyup","keyup"),this._addEvent(e,"ch-change","change")},_loadMain:function(){var e=document.querySelector("script[ch-main]");if(!e)return!1;var t=e.getAttribute("ch-main");if(this._path=t.substring(0,t.lastIndexOf("/")+1),t){var r=document.createElement("script");r.src=t,document.querySelector("head").appendChild(r),r.onload=function(){chop._loadView()}}},_loadView:function(e){var t;e===undefined&&(e=document);for(var r=e.querySelectorAll("[ch-view]"),n=0;n!==r.length;++n){t=r[n].getAttribute("ch-view"),t=t.replace(/\ /g,""),r[n].innerHTML="";for(var i,a=t.split(","),s=0;s!==a.length;++s){i=a[s];var u=window[i].render();u&&(r[n].innerHTML+=u)}}chop._registerEvents(e),chop._bindSources(e)},http:function(e){if(!e.url)return!1;var t=e.url,r=e.method||"GET";r=r.toUpperCase();var n=e.data||{},i="";for(var a in n)n.hasOwnProperty(a)&&(i+=a+"="+n[a]+"&");n=i.slice(0,-1);var s=e.done||function(){return!1};e.async===undefined&&(e.async=!0);var u,o=e.async;u=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),u.open(r,t,o),u.onreadystatechange=function(){4===u.readyState&&o&&s({data:u.responseText,status:u.status})};var c=r&&"GET"!==r.toUpperCase()&&0!==n.length;return c?(u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.send(n)):u.send(),o?void 0:u.responseText},define:function(e,t){this.modules[e]=t()},_useModule:function(e,t){var r,n=e,i=n.shift(),a=this,s=document.querySelector('script[ch-module="'+i+'"]');if(s)this._executeModule(n,t);else{var u=this.http({url:this._path+i+".js",method:"get",async:!1});r=document.createElement("script"),r.setAttribute("ch-module",i),r.text=u,document.querySelector("head").appendChild(r),a._executeModule(n,t)}},_executeModule:function(e,t){e.length?this._useModule(e,t):t&&t()},require:function(e,t){return e?(_isArray(e)||(e=[e]),void this._useModule(e,t)):!1},module:function(e){return e!==undefined?this.modules[e]:this.modules},source:function(e,t){if(0===arguments.length)return this.sources;if(1===arguments.length){var r=this.sources[e];return r===undefined?undefined:r.data}var n=2===arguments.length&&this.sources[e]!==undefined;if(!n)return 2===arguments.length?(this.sources[e]={},this.sources[e].els=[],this.sources[e].data=t,this.sources[e]):!1;var i=this.sources[e];i.data=t;for(var a=0,s=i.els.length;a!==s;++a){var u=i.els[a];"INPUT"===u.tagName.toUpperCase()?u.value=t:u.innerHTML=t}},_bindSources:function(e){e===undefined&&(e=document);for(var t=e.querySelectorAll("[ch-source]"),r=0;r!==t.length;++r){var n=t[r],i=n.getAttribute("ch-source"),a=this.sources[i],s="";a===undefined&&(this.sources[i]={},a=this.sources[i],a.els=[],n.value!==undefined&&(s=n.value)),a.els.push(n),a.data=s,n.addEventListener("keyup",function(){a.data=this.value,a.els.forEach(function(e){var t;t="INPUT"===e.tagName.toUpperCase()?"value":"innerHTML",e[t]!==a.data&&(e[t]=a.data)})})}},each:function(e,t){var r,n,i;if(2!==arguments.length)throw new Error("$ch.each requires two parameters (i.e. obj, callback).");if(r=t,_isArray(e))for(i=0;i!==e.length;++i)n=e[i],r(n,i,e);else{var a=Object.keys(e);for(i=0;i!==a.length;++i){var s=a[i],u=e[s];r(s,u,i,e)}}},_checkMatch:function(data,expr){var $$=data;return eval(expr)},filter:function(e,t){var r=[];if(2!==arguments.length)throw new Error("$ch.filter requires two parameters (i.e. obj, expr).");if(e===undefined||null===e)return r;for(var n=0;n!==e.length;++n){var i=e[n];this._checkMatch(i,t)&&r.push(i)}return r}};root.$ch=chop,root.onload=function(){chop._loadMain()}}(window);