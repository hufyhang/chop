$ch.define("widget",function(){"use strict";$ch.require("router");var e="_chopjs_widget_data_tunnel_",t=[],n=$$CHOP._afterLoadView;$$CHOP._afterLoadView=function(){n();for(var i=t.pop();void 0!==i;){var r=i.widget,o=i.key,d=i.callback;if(null===document.getElementById(r))return void 0;var a=document.getElementById(r).getAttribute("widget"),u=document.getElementById(r).querySelector("iframe").contentWindow.document;u=u.getElementById(e+a);var c;null===u&&(c=void 0);var l=u.getAttribute("value");null===l&&(c=void 0),l=decodeURIComponent(l);var g=JSON.parse(l);c="string"==typeof o?g[o]:g,d(c),i=t.pop()}return!0},$$CHOP.widget={},$$CHOP.widget={_widgets:{},_tunnel:{},register:function(e){var t=this;$$CHOP.each(e,function(e,n){t._widgets[e]={name:e,view:n}})},tunnel:{set:function(e,t){if(2!==arguments.length)throw new Error("$ch.widget.tunnel.set requires two parameters.");var n=JSON.stringify(t);n=encodeURIComponent(n),$$CHOP.widget._tunnel[e]=n},get:function(e,n,i){if(arguments.length<2)throw new Error("$ch.widget.tunnel.get requires at least two parameter.");2===arguments.length&&(i=n,n=void 0);var r={widget:e,key:n,callback:i};t.push(r)}}},$$CHOP.router.add({"_chopjs_widget/:name/:data":function(t){var n={},i=t.data.split("&");$$CHOP.each(i,function(e){var t=e.split("=")[0].trim(),i=e.split("=")[1].trim();n[t]=i});var r,o=$$CHOP.widget._widgets[t.name];r=void 0===o?$$CHOP.view({html:"Oops! No such Chop.js widget."}):o.view(n);var d=document.querySelectorAll("body style"),a=document.querySelectorAll("body script");$$CHOP.find("body").view(r),$$CHOP.each(d,function(e){document.body.appendChild(e)}),$$CHOP.each(a,function(e){document.body.appendChild(e)}),$$CHOP.each($$CHOP.widget._tunnel,function(t,n){var i=document.createElement("ch-widget-data-tunnel");i.setAttribute("id",e+t),i.setAttribute("style","display: none"),i.setAttribute("value",n),document.body.appendChild(i)})}});var i=function(e){var t=e.querySelectorAll("ch-widget");$$CHOP.each(t,function(e){if(null===e.querySelector("iframe")){var t,n=e.getAttribute("src").trim(),i=e.getAttribute("widget").trim();t="/"===n.slice(-1)?"#/_chopjs_widget/":"/#/_chopjs_widget/",n=n+t+i;var r=[],o=e.querySelectorAll("ch-data");$$CHOP.each(o,function(e){var t=e.getAttribute("key").trim(),n=e.innerHTML;r.push(t+"="+n)}),n+="/"+r.join("&"),e.innerHTML='<iframe src="'+n+'"></iframe>'}})};i(document);var r=$$CHOP._loadView;$$CHOP._loadView=function(e){var t=!0;void 0===e&&(e=document,t=!1),r(e),t&&i(e)}});