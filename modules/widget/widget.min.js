$ch.define("widget",function(){"use strict";$ch.require("router");var e="_chopjs_widget_data_tunnel";$$CHOP.widget={},$$CHOP.widget={_widgets:{},register:function(e){var t=this;$$CHOP.each(e,function(e,i){t._widgets[e]={name:e,view:i}})},tunnel:{set:function(t){if("object"!=typeof t)throw new Error("$ch.widget.tunnel.set requires an object-type parameter.");var i=JSON.stringify(t);i=encodeURIComponent(i);var n=document.createElement("input");n.setAttribute("id",e),n.setAttribute("type","hide"),n.setAttribute("value",i),document.body.appendChild(n)},get:function(t,i){if(0===arguments.length)throw new Error("$ch.widget.tunnel.get requires at least one parameter.");var n=document.getElementById(t).contentWindow.document,r=n.getElementById(e).getAttribute("value");r=decodeURIComponent(r);var o=JSON.parse(r);return"string"==typeof i?o[i]:o}}},$$CHOP.router.add({"_chopjs_widget/:name/:data":function(e){var t={},i=e.data.split("&");$$CHOP.each(i,function(e){var i=e.split("=")[0].trim(),n=e.split("=")[1].trim();t[i]=n});var n,r=$$CHOP.widget._widgets[e.name];n=void 0===r?$$CHOP.view({html:"Oops! No such Chop.js widget."}):r.view(t);var o=document.querySelectorAll("body style"),d=document.querySelectorAll("body script");$$CHOP.find("body").view(n),$$CHOP.each(o,function(e){document.body.appendChild(e)}),$$CHOP.each(d,function(e){document.body.appendChild(e)})}});var t=function(e){var t=e.querySelectorAll("ch-widget");$$CHOP.each(t,function(e){if(null===e.querySelector("iframe")){var t,i=e.getAttribute("src").trim(),n=e.getAttribute("widget").trim();t="/"===i.slice(-1)?"#/_chopjs_widget/":"/#/_chopjs_widget/",i=i+t+n;var r=[],o=e.querySelectorAll("ch-data");$$CHOP.each(o,function(e){var t=e.getAttribute("key").trim(),i=e.innerHTML;r.push(t+"="+i)}),i+="/"+r.join("&"),e.innerHTML='<iframe src="'+i+'"></iframe>'}})};t(document);var i=$$CHOP._loadView;$$CHOP._loadView=function(e){var n=!0;void 0===e&&(e=document,n=!1),i(e),n&&t(e)}});