$ch.define("widget",function(){"use strict";$ch.require("router");var e="chopjs:data-tunnel";$$CHOP.widget={},$$CHOP.widget={_widgets:{},_tunnel:{},register:function(e){var t=this;$$CHOP.each(e,function(e,n){t._widgets[e]={name:e,view:n}})},tunnel:{set:function(e,t){if(2!==arguments.length)throw new Error("$ch.widget.tunnel.set requires two parameters.");var n=JSON.stringify(t);n=encodeURIComponent(n),$$CHOP.widget._tunnel[e]=n},get:function(t,n,r){if(arguments.length<2)throw new Error("$ch.widget.tunnel.get requires at least two parameters.");if(null===document.getElementById(t))return void 0;var i=document.getElementById(t).querySelector("iframe").contentWindow.document;if(i=i.querySelector('head meta[typeof="'+e+'"][property="'+n+'"]'),null===i)return void 0;var o=i.getAttribute("content");if(null===o)return void 0;o=decodeURIComponent(o);var u=JSON.parse(o);return"string"==typeof r?u[r]:u}}},$$CHOP.router.add({"_chopjs_widget/:name/:data":function(t){var n={},r=t.data.split("&");$$CHOP.each(r,function(e){var t=e.split("=")[0].trim(),r=e.split("=")[1].trim();n[t]=r});var i,o=$$CHOP.widget._widgets[t.name];i=void 0===o?$$CHOP.view({html:"Oops! No such Chop.js widget."}):o.view(n);var u=document.querySelectorAll("body style"),d=document.querySelectorAll("body script");$$CHOP.find("body").view(i),$$CHOP.each(u,function(e){document.body.appendChild(e)}),$$CHOP.each(d,function(e){document.body.appendChild(e)}),$$CHOP.each($$CHOP.widget._tunnel,function(t,n){var r=document.createElement("meta");r.setAttribute("typeof",e),r.setAttribute("property",t),r.setAttribute("content",n),document.head.appendChild(r)})}});var t=function(e){var t=e.querySelectorAll("ch-widget");$$CHOP.each(t,function(e){if(null===e.querySelector("iframe")){var t,n=e.getAttribute("src").trim(),r=e.getAttribute("widget").trim();t="/"===n.slice(-1)?"#/_chopjs_widget/":"/#/_chopjs_widget/",n=n+t+r;var i=[],o=e.querySelectorAll("ch-data");$$CHOP.each(o,function(e){var t=e.getAttribute("key").trim(),n=e.innerHTML;i.push(t+"="+n)}),n+="/"+i.join("&"),e.innerHTML='<iframe src="'+n+'"></iframe>'}})};t(document);var n=$$CHOP._loadView;$$CHOP._loadView=function(e){var r=!0;void 0===e&&(e=document,r=!1),n(e),t(e),r&&t(e)}});