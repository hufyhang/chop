$ch.define("router",function(){"use strict";var e=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r=!1,t=!1,o=$$CHOP._afterLoadView;$$CHOP._afterLoadView=function(){o(),t&&(t=!1,$$CHOP.router.navigate())},window.addEventListener("onhashchange",function(){$$CHOP.router.navigate()}),$$CHOP.router={},$$CHOP.router={routes:{},mode:"hash",root:"/",getFragment:function(){var e=window.location.href.match(/#(.*)$/),r=e?e[1]:"";return this.clearSlashes(r)},clearSlashes:function(e){return e.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(e){if(void 0===e)throw new Error("$ch.router.add requires a parameter.");var o,a;for(var n in e)e.hasOwnProperty(n)&&(o=n,a=e[n],this.routes[o]=a);return""!==this.getFragment()&&r===!1&&(t=!0),!0},remove:function(r){return r&&(e(r)||(r=[r]),r.forEach(function(e){delete this.routes[e]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(e){if(void 0!==e){var r=e.match(/^\/.*/);r||(e="/"+e),window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+e}for(var t=this.getFragment(e),o={},a=Object.keys(this.routes),n=0,i=a.length;n!==i;++n){var h=a[n];h=h.replace(/:\w+/g,".+");var c=new RegExp(h),s=t.match(c);if(null!==s){var u=a[n],f=[],l=u.match(/:\w+/g);if(null!==l){var v,d,g=u.split("/");for(v=0,d=l.length;v!==d;++v){var w=l[v],$=g.indexOf(w),p=w.replace(/:/,"");-1!==$&&void 0===o[p]&&(f.push($),o[p]="")}g=t.split("/");var m=Object.keys(o);for(v=0,d=f.length;v!==d;++v){var O=f[v];o[m[v]]=g[O]}}}}a=Object.keys(this.routes);for(var P=0;P!==a.length;++P){var y=a[P],C=a[P];if(void 0!==y){y=y.replace(/\//g,"\\/"),y=y.replace(/:\w+/g,".+");var H=new RegExp(y);null!==t.match(H)&&this.routes[C](o)}}return this}}});