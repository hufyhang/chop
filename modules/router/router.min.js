$ch.define("router",function(){"use strict";var r=function(r){return"[object Array]"===Object.prototype.toString.call(r)},t=!1,e=!1,o=$$CHOP._afterLoadView;$$CHOP._afterLoadView=function(){o(),e&&(e=!1,$$CHOP.router.navigate())},$$CHOP.router={},$$CHOP.router={routes:{},mode:"hash",root:"/",getFragment:function(){var r=window.location.href.match(/#(.*)$/),t=r?r[1]:"";return this.clearSlashes(t)},clearSlashes:function(r){return r.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(r){if(void 0===r)throw new Error("$ch.router.add requires a parameter.");var o,a;for(var n in r)r.hasOwnProperty(n)&&(o=n,a=r[n],this.routes[o]=a);return""!==this.getFragment()&&t===!1&&(e=!0),!0},remove:function(t){return t&&(r(t)||(t=[t]),t.forEach(function(r){delete this.routes[r]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(r){if(void 0!==r){var t=r.match(/^\/.*/);t||(r="/"+r),window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+r}for(var e=this.getFragment(r),o={},a=Object.keys(this.routes),n=0,i=a.length;n!==i;++n){var h=a[n];h=h.replace(/:\w+/g,".+");var c=new RegExp(h),s=e.match(c);if(null!==s){var u=a[n],l=[],f=u.match(/:\w+/g);if(null!==f){var v,g,d=u.split("/");for(v=0,g=f.length;v!==g;++v){var w=f[v],p=d.indexOf(w),$=w.replace(/:/,"");-1!==p&&void 0===o[$]&&(l.push(p),o[$]="")}d=e.split("/");var m=Object.keys(o);for(v=0,g=l.length;v!==g;++v){var O=l[v];o[m[v]]=d[O]}}}}a=Object.keys(this.routes);for(var y=0;y!==a.length;++y){var P=a[y],b=a[y];if(void 0!==P){P=P.replace(/\//g,"\\/"),P=P.replace(/:\w+/g,".+");var j=new RegExp(P);null!==e.match(j)&&this.routes[b](o)}}return this}}});