$ch.define("event",function(){"use strict";var t={},e={};$$CHOP.originalSourceFunction=$$CHOP.source;var r=function(t){var e=0;for(var r in t)t.hasOwnProperty(r)&&++e;return e},a=function(t){var e="change";if("TEXTAREA"===t.tagName.toUpperCase())e="keyup";else if("INPUT"===t.tagName.toUpperCase()){var r=t.getAttribute("type").toUpperCase(),a="TEXT"===r||"PASSWORD"===r;a&&(e="keyup")}return e};$$CHOP.event={},$$CHOP.event={watches:e,listen:function(e,r){if(0===arguments.length)throw new Error("$ch.event.listen requires at least one parameter.");if(1===arguments.length){var a;return a=void 0!==t[e]?t[e]._callback:void 0}t[e]={},t[e]._event=e,t[e]._callback=r},emit:function(e,r){if(0===arguments.length)throw new Error("$ch.event.emit requires at least one parameter.");if($$CHOP._isArray(e)===!1){if(void 0===t[e])return void 0;t[e]._callback(r)}else for(var a=0,n=e.length;a!==n;++a)t[e[a]]._callback(r)},watch:function(t,r){if(2!==arguments.length)throw new Error("$ch.event.watch requires two parameters. i.e. data-source name, callback.");var n,s=$$CHOP.sources[t].data;n=$$CHOP._isArray(s)?s.slice(0):"object"==typeof s?Object.create(s):s,e[t]={source:t,old:n,callback:r};var i=function(){if($$CHOP.sources[t].data!==e[t].old){var a={},n=$$CHOP.sources[t].data;a.current=n,a.old=e[t].old,r(a),e[t].old=n}};e[t].watchChange=i;for(var c=0,o=$$CHOP.sources[t].els.length;c!==o;++c){var u=$$CHOP.sources[t].els[c],l=a(u);u.addEventListener(l,i)}},unwatch:function(t){if(1!==arguments.length)throw new Error("$ch.event.unwatch has to be given a data-source name parameter.");for(var r=0,n=$$CHOP.sources[t].els.length;r!==n;++r){var s=$$CHOP.sources[t].els[r],i=a(s);s.removeEventListener(i,e[t].watchChange)}delete e[t]},queue:function(){var t={callbacks:[],current:0,length:0,data:void 0,state:"stop",add:function(t){if(void 0!==t)if($$CHOP.isArray(t)){var e=this;$$CHOP.each(t,function(t){e.callbacks.push(t),++this.length})}else this.callbacks.push(t),++this.length;return this},remove:function(t){if(void 0!==t){var e;if($$CHOP.isArray(t)){var r=this;$$CHOP.each(t,function(t){e=r.callbacks.indexOf(t),-1!==e&&(r.callbacks.splice(e,1),--r.length)})}else e=this.callbacks.indexOf(t),-1!==e&&(this.callbacks.splice(e,1),--this.length)}return this},promote:function(t){if(void 0!==t){var e=this.callbacks.indexOf(t);if(-1!==e){var r=this.callbacks.splice(e,1)[0];this.callbacks.unshift(r)}}return this},reset:function(){return this.current=0,this},run:function(t){this.data=t,this.state="run";for(var e=this.current,r=this.length;e!==r;++e,++this.current){if("stop"===this.state)return this.current=0,this.data;if("pause"===this.state)return this.data;"run"===this.state&&(this.data=this.callbacks[e](this.data))}this.state="stop",this.current=0},stop:function(){return this.state="stop",this},pause:function(){return this.state="pause",this}};return $$CHOP.each(arguments,function(e,r){t.add(r)}),t}};var n=function(t){var a=e[t];if(void 0===a)return void 0;var n=$$CHOP.sources[a.source].data,s=!1;if(typeof n!=typeof a.old)s=!0;else if($$CHOP._isArray(n)){if(n.length!==a.old.length)s=!0;else for(var i=0,c=n.length;i!==c;++i)if(n[i]!==a.old[i]){s=!0;break}}else"object"==typeof n&&s===!1?r(n)!==r(a.old)?s=!0:$$CHOP.each(n,function(t){n[t]!==a.old[t]&&(s=!0)}):n!==a.old&&s===!1&&(s=!0);s===!0&&(a.current=n,a.old=n,a.callback(a))},s=function(t,e){return 0===arguments.length?$$CHOP.originalSourceFunction():1===arguments.length?$$CHOP.originalSourceFunction(t):($$CHOP.originalSourceFunction(t,e),void n(t))};$$CHOP.source=s});