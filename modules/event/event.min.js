$ch.define("event",function(){"use strict";var e={},r={};$$CHOP.originalSourceFunction=$$CHOP.source;var t=function(e){var r=0;for(var t in e)e.hasOwnProperty(t)&&++r;return r},a=function(e){var r="change";if("TEXTAREA"===e.tagName.toUpperCase())r="keyup";else if("INPUT"===e.tagName.toUpperCase()){var t=e.getAttribute("type").toUpperCase(),a="TEXT"===t||"PASSWORD"===t;a&&(r="keyup")}return r};$$CHOP.event={},$$CHOP.event={watches:r,listen:function(r,t){if(0===arguments.length)throw new Error("$ch.event.listen requires at least one parameter.");if(1===arguments.length){var a;return a=void 0!==e[r]?e[r]._callback:void 0}e[r]={},e[r]._event=r,e[r]._callback=t},emit:function(r,t){if(0===arguments.length)throw new Error("$ch.event.emit requires at least one parameter.");return void 0===e[r]?void 0:void e[r]._callback(t)},watch:function(e,t){if(2!==arguments.length)throw new Error("$ch.event.watch requires two parameters. i.e. data-source name, callback.");var n,o=$$CHOP.sources[e].data;n=$$CHOP._isArray(o)?o.slice(0):"object"==typeof o?Object.create(o):o,r[e]={source:e,old:n,callback:t};var c=function(){if($$CHOP.sources[e].data!==r[e].old){var a={},n=$$CHOP.sources[e].data;a.current=n,a.old=r[e].old,t(a),r[e].old=n}};r[e].watchChange=c;for(var i=0,s=$$CHOP.sources[e].els.length;i!==s;++i){var u=$$CHOP.sources[e].els[i],l=a(u);u.addEventListener(l,c)}},unwatch:function(e){if(1!==arguments.length)throw new Error("$ch.event.unwatch has to be given a data-source name parameter.");for(var t=0,n=$$CHOP.sources[e].els.length;t!==n;++t){var o=$$CHOP.sources[e].els[t],c=a(o);o.removeEventListener(c,r[e].watchChange)}delete r[e]}};var n=function(e){var a=r[e];if(void 0===a)return void 0;var n=$$CHOP.sources[a.source].data,o=!1;if(typeof n!=typeof a.old)o=!0;else if($$CHOP._isArray(n)){if(n.length!==a.old.length)o=!0;else for(var c=0,i=n.length;c!==i;++c)if(n[c]!==a.old[c]){o=!0;break}}else"object"==typeof n&&o===!1?t(n)!==t(a.old)?o=!0:$$CHOP.each(n,function(e){n[e]!==a.old[e]&&(o=!0)}):n!==a.old&&o===!1&&(o=!0);o===!0&&(a.current=n,a.old=n,a.callback(a))},o=function(e,r){return 0===arguments.length?$$CHOP.originalSourceFunction():1===arguments.length?$$CHOP.originalSourceFunction(e):($$CHOP.originalSourceFunction(e,r),void n(e))};$$CHOP.source=o});