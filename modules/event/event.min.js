$ch.define("event",function(){"use strict";var e={},t={};$$CHOP.originalSourceFunction=$$CHOP.source;var r=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&++t;return t},n=function(e){var t="change";if("TEXTAREA"===e.tagName.toUpperCase())t="keyup";else if("INPUT"===e.tagName.toUpperCase()){var r=e.getAttribute("type").toUpperCase(),n="TEXT"===r||"PASSWORD"===r;n&&(t="keyup")}return t};$$CHOP.event={},$$CHOP.event={watches:t,listen:function(t,r){if(0===arguments.length)throw new Error("$ch.event.listen requires at least one parameter.");if(1===arguments.length){var n;return n=void 0!==e[t]?e[t]._callback:void 0}return e[t]={},e[t]._event=t,e[t]._callback=r,this},emit:function(t,r){if(0===arguments.length)throw new Error("$ch.event.emit requires at least one parameter.");if($$CHOP._isArray(t)===!1){if(void 0===e[t])return void 0;e[t]._callback(r)}else for(var n=0,a=t.length;n!==a;++n)e[t[n]]._callback(r);return this},watch:function(e,r){if(2!==arguments.length)throw new Error("$ch.event.watch requires two parameters. i.e. data-source name, callback.");var a,i=$$CHOP.sources[e].data;a=$$CHOP._isArray(i)?i.slice(0):"object"==typeof i?Object.create(i):i,t[e]={source:e,old:a,callback:r};var s=function(){if($$CHOP.sources[e].data!==t[e].old){var n={},a=$$CHOP.sources[e].data;n.current=a,n.old=t[e].old,r(n),t[e].old=a}};t[e].watchChange=s;for(var o=0,c=$$CHOP.sources[e].els.length;o!==c;++o){var u=$$CHOP.sources[e].els[o],l=n(u);u.addEventListener(l,s)}return this},unwatch:function(e){if(1!==arguments.length)throw new Error("$ch.event.unwatch has to be given a data-source name parameter.");for(var r=0,a=$$CHOP.sources[e].els.length;r!==a;++r){var i=$$CHOP.sources[e].els[r],s=n(i);i.removeEventListener(s,t[e].watchChange)}return delete t[e],this},once:function(e,t){var r,n;return function(){return n?r:(r=e.apply(t||this,arguments),n=1,e=null,r)}},nextTick:function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var r=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),r.length>0)){var n=r.shift();n()}},!0),function(e){r.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),queue:function(){var e={callbacks:[],current:0,length:0,data:void 0,add:function(e){if(void 0!==e)if($$CHOP.isArray(e)){var t=this;$$CHOP.each(e,function(e){t.callbacks.push(e),++t.length})}else this.callbacks.push(e),++this.length;return this},remove:function(e){if(void 0!==e){var t;if($$CHOP.isArray(e)){var r=this;$$CHOP.each(e,function(e){t=r.callbacks.indexOf(e),-1!==t&&(r.callbacks.splice(t,1),--r.length)})}else t=this.callbacks.indexOf(e),-1!==t&&(this.callbacks.splice(t,1),--this.length)}return this},promote:function(e){if(void 0!==e){var t=this.callbacks.indexOf(e);if(-1!==t){var r=this.callbacks.splice(t,1)[0];this.callbacks.unshift(r)}}return this},reset:function(){return this.current=0,this},run:function(e){if(0!==arguments.length&&(this.data=e),this.current<this.length){var t=this.current;++this.current,this.data=this.callbacks[t](this.data)}return this.data},stop:function(){this.current=0;var e=this.data;return this.data=void 0,e}};return $$CHOP.each(arguments,function(t,r){e.add(r)}),e}};var a=function(e){var n=t[e];if(void 0===n)return void 0;var a=$$CHOP.sources[n.source].data,i=!1;if(typeof a!=typeof n.old)i=!0;else if($$CHOP._isArray(a)){if(a.length!==n.old.length)i=!0;else for(var s=0,o=a.length;s!==o;++s)if(a[s]!==n.old[s]){i=!0;break}}else"object"==typeof a&&i===!1?r(a)!==r(n.old)?i=!0:$$CHOP.each(a,function(e){a[e]!==n.old[e]&&(i=!0)}):a!==n.old&&i===!1&&(i=!0);i===!0&&(n.current=a,n.old=a,n.callback(n))},i=function(e,t){return 0===arguments.length?$$CHOP.originalSourceFunction():1===arguments.length?$$CHOP.originalSourceFunction(e):($$CHOP.originalSourceFunction(e,t),void a(e))};$$CHOP.source=i});